<section class="hero-banner" id="hero-banner">
  <canvas class="hero-banner-canvas" id="firework-canvas" aria-hidden="true"></canvas>
  <p class="hero-banner-text">{{ include.text | default: "Be yourself and don't go with the flow." | escape }}</p>
</section>

<script>
(function() {
  'use strict';
  var canvas = document.getElementById('firework-canvas');
  if (!canvas) return;

  var banner = document.getElementById('hero-banner');
  var ctx = canvas.getContext('2d');
  var particles = [];
  var lastEmit = 0;
  var throttle = 30;

  function resize() {
    canvas.width = banner.offsetWidth;
    canvas.height = banner.offsetHeight;
  }

  function createParticle(x, y) {
    var angle = Math.random() * Math.PI * 2;
    var speed = 1.2 + Math.random() * 3;
    return {
      x: x, y: y,
      vx: Math.cos(angle) * speed,
      vy: Math.sin(angle) * speed,
      life: 1,
      decay: 0.012 + Math.random() * 0.012,
      size: 2.5 + Math.random() * 3.5,
      sparkle: Math.random() > 0.6
    };
  }

  function emit(x, y) {
    for (var i = 0; i < 16; i++) {
      particles.push(createParticle(x, y));
    }
  }

  function animate() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    for (var i = particles.length - 1; i >= 0; i--) {
      var p = particles[i];
      p.x += p.vx;
      p.y += p.vy;
      p.life -= p.decay;
      if (p.life <= 0) {
        particles.splice(i, 1);
        continue;
      }
      ctx.globalAlpha = p.life;
      ctx.fillStyle = p.sparkle ? 'rgba(255, 255, 255, 0.95)' : 'rgba(128, 208, 237, 0.9)';
      ctx.beginPath();
      ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
      ctx.fill();
    }
    ctx.globalAlpha = 1;
  }

  function loop() {
    animate();
    requestAnimationFrame(loop);
  }

  banner.addEventListener('mousemove', function(e) {
    var now = Date.now();
    if (now - lastEmit > throttle) {
      lastEmit = now;
      var rect = banner.getBoundingClientRect();
      emit(e.clientX - rect.left, e.clientY - rect.top);
    }
  });

  banner.addEventListener('click', function(e) {
    var rect = banner.getBoundingClientRect();
    for (var i = 0; i < 20; i++) emit(e.clientX - rect.left, e.clientY - rect.top);
  });

  window.addEventListener('resize', resize);
  resize();
  loop();
})();
</script>
